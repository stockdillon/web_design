/*! ajaxnoir 2017-06-28 */

function Login(e){var t=$(e);t.submit(function(o){o.preventDefault(),console.log("Submitted"),$.ajax({url:"post/login.php",data:t.serialize(),method:"POST",success:function(t){var o=parse_json(t);o.ok?window.location.assign("./"):$(e+" .message").html("<p>"+o.message+"</p>")},error:function(t,o,r){$(e+" .message").html("<p>Error: "+r+"</p>")}})})}function MovieInfo(e,t,o){console.log("MovieInfo: "+t+"/"+o),$.ajax({url:"https://api.themoviedb.org/3/search/movie",data:{api_key:"fcef748263676c69166c66661f0b77db",query:t,year:o},method:"GET",dataTpe:"text",success:function(e){if(e.results.length>0){console.log("Successful MovieDB Query");var t=$(".paper > ul > li"),o=t.get(0),r=t.get(1),n=t.get(2);console.log(o),console.log(r),console.log(n);var l="<p>"+e.results[0].title+"</p><p>"+e.results[0].release_date;l+="</p><p>"+e.results[0].vote_average+"</p><p>"+e.results[0].vote_count+"</p>",$(o).children("div").html(l);var s="<p>"+e.results[0].overview+"</p>";console.log(r),$(r).children("div").html(s);var a=e.results[0].poster_path;if(null===a)i="";else{var i="http://image.tmdb.org/t/p/w500/"+(a=a.substr(1));$(n).children("div").children("p").children("img").attr("src",i),$(n).children("div").children("p").children("img").attr("opacity","0.5")}}else console.log("Info Request Failed"),$(".paper").html("<p>No information available</p>")},error:function(e,t,o){console.log("Info Request Failed (No Connection)"),$(".paper").html("<p>Unable to communicate<br>with themoviedb.org</p>")}});var r=$(".paper > ul > li");$(r).children(0);$(r.get(0)).children("a").children("img").css({opacity:1}),console.log(r);for(var n=0;n<r.length;n++)this.installListener(r,n)}function parse_json(e){try{var t=$.parseJSON(e)}catch(t){throw"JSON parse error: "+e}return t}function Stars(e){console.log("Stars constructor");var t=$(e+" table");console.log(t);for(var o=t.find("tr"),r=1;r<o.length;r++)for(var n=$(o.get(r)),l=n.find('input[name="id"]').val(),s=n.find("img"),a=0;a<=s.length;a++){var i=$(s.get(a));this.installListener(n,i,l,a+1)}}MovieInfo.prototype.installListener=function(e,t){var t=t,o=$(e.get(t)).children("a");console.log("listening for tab "+t),o.click(function(e){e.preventDefault();for(var t=this,o=$(".paper > ul > li"),r=0;r<3;r++){var n=$(o.get(r));$(n).children("div").fadeOut(2e3),$(n).children("a").children("img").css({opacity:.3})}$(t).parents("li").children("div").attr("class","show").hide().fadeIn(2e3),$(t).children("img").css({opacity:1}).hide().fadeIn(2e3),console.log(t)})},Stars.prototype.installListener=function(e,t,o,r){var n=this;console.log("listening..."),t.click(function(){$.ajax({url:"post/stars.php",data:{id:o,rating:r},method:"POST",success:function(e){var t=parse_json(e);console.log(t),t.ok?(n.updateTable(t.table),n.message("<p>Successfully updated</p>"),new Stars("form")):n.message("<p>Update failed</p>")},error:function(e,t,o){n.message("<p>Error: "+o+"</p>")}})})},Stars.prototype.message=function(e){$(".message").html(e).show().delay(2e3).fadeOut(1e3)},Stars.prototype.updateTable=function(e){$(".table").html(e)};