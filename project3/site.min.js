/*! project3 2017-06-30 */

function Game(e,t){console.log("Game constructor");var l=$(e+" table");this.table=$(e+" table");for(var o=l.find("tr"),s=0;s<o.length;s++)for(var a=$(o.get(s)).find("td"),n=0;n<a.length;n++){var r=$(a.get(n));"cell"==$(r).attr("class")&&this.installListener(r)}var c=$("#check"),i=$("#solved"),d=$("#clear");this.installButtonListener(c),this.installButtonListener(i),this.installButtonListener(d);var h=$("#yes"),g=$("#no");this.installYesNoListener(h),this.installYesNoListener(g)}Game.prototype.installListener=function(e){console.log("listening...");var t=this;e.click(function(e){if(!t.disabled){t.fixRed(),console.log("clicked!");var l=$(this).children("div");console.log(l.attr("class")),$(l).children("p").html("&nbsp;"),"empty"==l.attr("class")?l.attr("class","blue_cell"):"island"==l.attr("class")?l.attr("class","empty"):"blue_cell"==l.attr("class")&&(l.attr("class","island"),$(l).children("p").html("&#9679;")),t.isSolved()}})},Game.prototype.installButtonListener=function(e){console.log("listening for button...");var t=this;e.click(function(e){console.log("clicked!");var l=$(this).attr("id");return $("#message").css({color:"#732093"}),$("#message").show().css({"font-stlye":"italic"}),"check"==l?(console.log("clicked check"),void t.checkGame()):"solved"==l?($("#message").html("Are you sure you want to solve?"),$("#yes").attr("type","submit"),$("#no").attr("type","submit"),$("#solved").attr("type","hidden"),$("#check").attr("type","hidden"),void $("#clear").attr("type","hidden")):"clear"==l?(console.log("clicked clear"),void t.clearGame()):void 0})},Game.prototype.installYesNoListener=function(e){console.log("listening for YesNo...");var t=this;e.click(function(e){console.log("clicked Yes or No!");var l=$(this).attr("id");if(console.log(l),"yes"==l)console.log("attempting to call solveGame"),t.disabled=!0,t.solveGame();else if("no"==l)return $("#message").html(""),$("#yes").attr("type","hidden"),$("#no").attr("type","hidden"),$("#solved").attr("type","submit"),$("#check").attr("type","submit"),$("#clear").attr("type","submit"),!1})},Game.prototype.solveGame=function(){console.log("solving the game!");var e=this;$.ajax({url:"http://webdev.cse.msu.edu/~stockdil/project3/game-post.php",data:{test:"successful data transfer"},method:"GET",dataTpe:"text",success:function(t){if(null!=t&&t.length>0){console.log("Successful GET");var t=$.parseJSON(t);console.log(t);var l=t[0];console.log(l);var o=t[1];console.log(o),$("#yes").attr("type","hidden"),$("#no").attr("type","hidden"),$("#solved").attr("type","hidden"),$("#check").attr("type","hidden"),$("#clear").attr("type","hidden"),$("#message").html("You're a winner").css({color:"white"});var s=e.table.find("tr");console.log("number of rows: "+s.length);for(var a=0;a<s.length;a++)for(var n=$(s.get(a)).find("td"),r=0;r<n.length;r++){var c=$(n.get(r)),i=$(c).children("div");"locked"!=i.attr("class")&&("sea"==o[a][r]?i.attr("class","blue_cell"):"empty"==o[a][r]?i.attr("class","empty"):"island"==o[a][r]&&(i.attr("class","island"),$(i).children("p").html("&#9679;")))}}else console.log("Info Request Failed")},error:function(e,t,l){console.log("Info Request Failed (No Connection)")}})},Game.prototype.clearGame=function(){console.log("clearing the game!");var e=this;$.ajax({url:"http://webdev.cse.msu.edu/~stockdil/project3/game-post.php",data:{test:"successful data transfer"},method:"GET",dataTpe:"text",success:function(t){if(null!=t&&t.length>0){console.log("Successful GET");var t=$.parseJSON(t);console.log(t);var l=t[0];console.log(l);var o=t[1];console.log(o),$("#yes").attr("type","hidden"),$("#no").attr("type","hidden");var s=e.table.find("tr");console.log("number of rows: "+s.length);for(var a=0;a<s.length;a++)for(var n=$(s.get(a)).find("td"),r=0;r<n.length;r++){var c=$(n.get(r)),i=$(c).children("div");"locked"!=i.attr("class")&&(i.attr("class","empty"),$(i).children("p").html("&nbsp;"))}}else console.log("Info Request Failed")},error:function(e,t,l){console.log("Info Request Failed (No Connection)")}})},Game.prototype.checkGame=function(){console.log("checking the game!");var e=this;$.ajax({url:"http://webdev.cse.msu.edu/~stockdil/project3/game-post.php",data:{test:"successful data transfer"},method:"GET",dataTpe:"text",success:function(t){if(null!=t&&t.length>0){console.log("Successful GET");var t=$.parseJSON(t);console.log(t);var l=t[0];console.log(l);var o=t[1];console.log(o),$("#yes").attr("type","hidden"),$("#no").attr("type","hidden");var s=e.table.find("tr");console.log("number of rows: "+s.length);for(var a=0;a<s.length;a++)for(var n=$(s.get(a)).find("td"),r=0;r<n.length;r++){var c=$(n.get(r)),i=$(c).children("div");"locked"!=i.attr("class")&&("sea"==o[a][r]?"island"==i.attr("class")&&i.attr("class","red_island"):"empty"==o[a][r]?i.attr("class","empty"):"island"==o[a][r]&&"blue_cell"==i.attr("class")&&i.attr("class","red_sea"))}}else console.log("Info Request Failed")},error:function(e,t,l){console.log("Info Request Failed (No Connection)")}})},Game.prototype.isSolved=function(){console.log("Checking if the user has won...");var e=this;$.ajax({url:"http://webdev.cse.msu.edu/~stockdil/project3/game-post.php",data:{test:"successful data transfer"},method:"GET",dataTpe:"text",success:function(t){if(null!=t&&t.length>0){console.log("Successful GET");var t=$.parseJSON(t);console.log(t);var l=t[0];console.log(l);var o=t[1];console.log(o),$("#yes").attr("type","hidden"),$("#no").attr("type","hidden");var s=e.table.find("tr");console.log("number of rows: "+s.length);for(var a=0;a<s.length;a++)for(var n=$(s.get(a)).find("td"),r=0;r<n.length;r++){var c=$(n.get(r)),i=$(c).children("div");if(console.log("div.class: "+i.attr("class")),console.log("correct value: "+o[a][r]),"locked"!=i.attr("class")){if("sea"==o[a][r]&&"island"==i.attr("class"))return console.log("cell "+a+","+r+" is incorrect"),!1;if("island"==o[a][r]&&"blue_cell"==i.attr("class"))return console.log("cell "+a+","+r+" is incorrect"),!1;if("empty"==i.attr("class"))return console.log("cell "+a+","+r+" is incorrect (EMPTY)"),!1}}return console.log("returning true... user has won."),$("#yes").attr("type","hidden"),$("#no").attr("type","hidden"),$("#solved").attr("type","hidden"),$("#check").attr("type","hidden"),$("#clear").attr("type","hidden"),$("#message").html("You're a winner").css({color:"white"}),e.disabled=!0,!0}console.log("Info Request Failed")},error:function(e,t,l){console.log("Info Request Failed (No Connection)")}})},Game.prototype.fixRed=function(){console.log("fixing red cells...");for(var e=this.table.find("tr"),t=0;t<e.length;t++)for(var l=$(e.get(t)).find("td"),o=0;o<l.length;o++){var s=$(l.get(o)),a=$(s).children("div");"locked"!=a.attr("class")&&("red_sea"==a.attr("class")?a.attr("class","blue_cell"):"red_island"==a.attr("class")&&a.attr("class","island"))}};